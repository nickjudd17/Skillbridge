{% extends "base.html" %}
{% block content %}
  <div class="container mt-4">
    <h2 class="mb-4">Available Projects</h2>

    {% if projects %}
      <div class="list-group">
        {% for project in projects %}
          <div class="list-group-item">
            <h5 class="mb-1">{{ project.title }}</h5>
            <p class="mb-2">{{ project.description }}</p>

            {% if current_user.is_authenticated %}
              <!-- Student actions -->
              {% if current_user.role == 'student' %}
                <a href="{{ url_for('applications.apply', project_id=project.id) }}" 
                   class="btn btn-sm btn-success me-2">Apply</a>
              {% endif %}

              <!-- Business actions (only for the owner of the project) -->
              {% if current_user.role == 'business' and project.business_id == current_user.id %}
                <a href="{{ url_for('applications.manage_applications', project_id=project.id) }}" 
                   class="btn btn-sm btn-secondary me-2">Manage Applications</a>

                <!-- CSRF-safe delete form -->
                <form action="{{ url_for('projects.delete_project', project_id=project.id) }}" 
                      method="post" 
                      style="display:inline;"
                      onsubmit="return confirm('Are you sure you want to delete this project?');">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
              {% endif %}

              <!-- Reviews -->
              <a href="{{ url_for('reviews.new_review', project_id=project.id) }}" 
                 class="btn btn-sm btn-warning me-2">Leave Review</a>
              <a href="{{ url_for('reviews.view_reviews', project_id=project.id) }}" 
                 class="btn btn-sm btn-info">View Reviews</a>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">No projects posted yet.</p>
    {% endif %}
  </div>
{% endblock %}